<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Buc Anh Cua Ngay</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW"
            crossorigin="anonymous"></script>
</head>
<body>
<img id="img-of-the-day">
<form th:action="@{/home}" th:object="${comment}" method="post">
    <select th:field="*{rate}">
        <option value="1" selected>1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
    </select></br>
    <label th:for="*{author}">Author:</label></br>
    <input type="text" th:field="*{author}" class="form-control"></br>
    <label th:for="*{message}">Feedback:</label></br>
    <textarea th:field="*{message}" rows="5" class="form-control"></textarea></br>
    <button type="submit" >Comment</button></br>
</form>

<ul th:each="c: ${comments}">
    <li>
        <span th:switch="*{c.rate}" >
            <span th:case="1" th:text="'+' + *{c.rate}" ></span>
            <span th:case="2" th:text="'+' + *{c.rate}" ></span>
            <span th:case="3" th:text="'+' + *{c.rate}" ></span>
            <span th:case="4" th:text="'+' + *{c.rate}" ></span>
            <span th:case="5" th:text="'+' + *{c.rate}" ></span>
        </span>
        <span th:text=" *{c.message}"></span></br>
        <span class="like-count" th:text="*{c.likeCount}"></span>
        <span class="like-text" th:text="*{c.likeCount} >= 1 ? 'likes' : 'like'"></span>
        <button th:onclick="'likeBtn(this, '+*{c.id}+')'"
                data-bs-toggle="tooltip" data-bs-placement="top" title="Like">Like</button>
    </li>
</ul>
<script>
    // Enable tooltips
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl)
    })
    let query = 'https://api.nasa.gov/planetary/apod?api_key=HsenWY8avtxcLbgr8yEKXQCl4701sKcCYJt7wGja';
    let request = new XMLHttpRequest();
    request.open('GET', query);
    request.onload = function() {
        if (request.status === 200) {
            let response = JSON.parse(request.responseText);
            document.getElementById('img-of-the-day').setAttribute('src', response.url);
        }
    };
    request.send();
    // Enable tooltips
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl)
    })
    function likeBtn(element, id) {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                let response = JSON.parse(this.responseText);
                element.classList.toggle("btn-primary");
                var likeCountElement = element.parentNode.querySelector('.like-count');
                var likeTextElement = element.parentNode.querySelector('.like-text');
                if (likeCountElement && likeTextElement) {
                    likeCountElement.innerHTML = response.likeCount;
                    likeTextElement.innerHTML = response.likeCount != 1 ? 'likes' : 'like';
                }
            }
        };
        xhttp.open("POST", "/home/like/" + id, true);
        xhttp.send();
    }
</script>
</body>
</html>